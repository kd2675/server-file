# 📁 Server-File
Second 프로젝트의 파일 처리 마이크로서비스

## 📖 프로젝트 개요
이미지 파일의 업로드, 저장, 다운로드 기능을 제공

## 🎯 주요 기능

### 이미지 처리
- **이미지 업로드**: 다양한 형식의 이미지 파일 업로드
- **이미지 다운로드**: 저장된 이미지 파일 제공
- **이미지 변환**: 필요에 따른 이미지 형식 변환 및 리사이징

## 🛠️ 기술 스택
- **Spring Boot**: 기본 웹 프레임워크

## 💾 파일 저장 구조
### 디렉토리 구조

{ROOT_IMAGE_PATH}/
├── 2024/
│   ├── 01/
│   │   ├── 31/
│   │   │   ├── 20240131_a1b2c3d4.jpg           # 원본 파일
│   │   │   ├── 20240131_a1b2c3d4100100.jpg     # 100x100 리사이즈
│   │   │   ├── 20240131_a1b2c3d4200200.jpg     # 200x200 리사이즈
│   │   │   ├── 20240131_a1b2c3d4400400.jpg     # 400x400 리사이즈
│   │   │   └── 20240131_a1b2c3d4800800.jpg     # 800x800 리사이즈
│   │   └── ...
│   └── ...
└── ...

### 파일명 규칙
#### 원본 파일
- **형식**: `yyyyMMdd_UUID앞8자리.확장자`
- **생성 규칙**:
    - 업로드 날짜 (yyyyMMdd)
    - UUID 앞 8자리 (하이픈 앞 부분)
    - 원본 파일 확장자

- **예시**: `20240131_a1b2c3d4.jpg`

#### 자동 리사이즈 파일 (4개 크기)
- **형식**: `yyyyMMdd_UUID앞8자리{width}{height}.확장자`
- **지원 크기**:
    - 100x100: `20240131_a1b2c3d4100100.jpg`
    - 200x200: `20240131_a1b2c3d4200200.jpg`
    - 400x400: `20240131_a1b2c3d4400400.jpg`
    - 800x800: `20240131_a1b2c3d4800800.jpg`

### 디렉토리 생성 규칙
- **경로**: `/{yyyy}/{MM}/{dd}/`
- **자동 생성**: 업로드 시 해당 날짜 폴더가 없으면 자동 생성
- **예시**: 2024년 1월 31일 업로드 → `/2024/01/31/` 폴더

### 파일 처리 플로우
#### 업로드 시 자동 처리
1. **원본 파일 저장**: `{날짜}_{UUID}.{확장자}`
2. **4개 크기로 자동 리사이즈**: 100x100, 200x200, 400x400, 800x800
3. **리사이즈 파일 저장**: `{날짜}_{UUID}{width}{height}.{확장자}`
4. **파일명 반환**: API 응답으로 원본 파일명 반환

#### 파일 접근 방식
- **원본 이미지**: `/image/show/20240131_a1b2c3d4.jpg`
- **리사이즈 이미지**: 별도 API 필요시 구현 가능
- **자동 탐지**: ImageUtils.getPhotoUrl()을 통한 경로 자동 생성

### 파일 업데이트 처리
- **기존 파일 삭제**: 파일명에서 날짜 추출하여 경로 계산 후 삭제
- **새 파일 저장**: 새로운 UUID로 다시 저장
- **리사이즈 파일도 함께 갱신**: 모든 크기의 파일이 새로 생성됨


